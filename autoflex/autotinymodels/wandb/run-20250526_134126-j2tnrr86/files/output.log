✅ Created checkpoint directory: ../../cifar10checkpoints
✅ Loaded CIFAR-10 dataset
   Training samples: 50000
   Validation samples: 10000
✅ Loaded CIFAR-10 dataset (without normalization)
   Training samples: 50000
   Validation samples: 10000

================================================================================
🚀 CIFAR-10 MODEL TRAINING AND EVALUATION PIPELINE
================================================================================
📁 Dataset: ../../cifar10
📁 Checkpoints: ../../cifar10checkpoints
🎯 Device: cuda

✓ Main ViT model already exists at ../../cifar10checkpoints/bestmodel_main/best_model.pt

✓ Robust ViT model already exists at ../../cifar10checkpoints/bestmodel_robust/best_model.pt

✓ ResNet baseline already exists at ../../cifar10checkpoints/bestmodel_resnet18_baseline/best_model.pt

✓ Pretrained ResNet baseline already exists at ../../cifar10checkpoints/bestmodel_resnet18_pretrained/best_model.pt

✓ TTT model already exists at ../../cifar10checkpoints/bestmodel_ttt/best_model.pt
✓ TTT3fc model already exists at ../../cifar10checkpoints/bestmodel_ttt3fc/best_model.pt

=== TRAINING BLENDED MODELS ===
✅ Loaded base model for Blended training

🚀 Training BlendedTTT model on CIFAR-10...
Blended Epoch 1/50: 100%|█████████████████████| 391/391 [01:13<00:00,  5.32it/s]
Blended Epoch 1: Train Loss: 2.3526, Train Acc: 0.2690, Val Acc: 0.1142
  ✅ New best model saved with val_acc: 0.1142
Blended Epoch 2/50: 100%|█████████████████████| 391/391 [01:14<00:00,  5.27it/s]
Blended Epoch 2: Train Loss: 1.9380, Train Acc: 0.3906, Val Acc: 0.1153
  ✅ New best model saved with val_acc: 0.1153
Blended Epoch 3/50: 100%|█████████████████████| 391/391 [01:14<00:00,  5.25it/s]
Blended Epoch 3: Train Loss: 1.7687, Train Acc: 0.4481, Val Acc: 0.1323
  ✅ New best model saved with val_acc: 0.1323
Blended Epoch 4/50: 100%|█████████████████████| 391/391 [01:15<00:00,  5.21it/s]
Blended Epoch 4: Train Loss: 1.6665, Train Acc: 0.4850, Val Acc: 0.1134
  No improvement for 1 epochs
Blended Epoch 5/50: 100%|█████████████████████| 391/391 [01:15<00:00,  5.15it/s]
Blended Epoch 5: Train Loss: 1.5993, Train Acc: 0.5060, Val Acc: 0.1428
  ✅ New best model saved with val_acc: 0.1428
Blended Epoch 6/50: 100%|█████████████████████| 391/391 [01:17<00:00,  5.05it/s]
Blended Epoch 6: Train Loss: 1.5378, Train Acc: 0.5269, Val Acc: 0.1429
  ✅ New best model saved with val_acc: 0.1429
Blended Epoch 7/50: 100%|█████████████████████| 391/391 [01:19<00:00,  4.91it/s]
Blended Epoch 7: Train Loss: 1.4998, Train Acc: 0.5393, Val Acc: 0.1594
  ✅ New best model saved with val_acc: 0.1594
Blended Epoch 8/50: 100%|█████████████████████| 391/391 [01:19<00:00,  4.91it/s]
Blended Epoch 8: Train Loss: 1.4610, Train Acc: 0.5533, Val Acc: 0.1444
  No improvement for 1 epochs
Blended Epoch 9/50: 100%|█████████████████████| 391/391 [01:18<00:00,  4.97it/s]
Blended Epoch 9: Train Loss: 1.4208, Train Acc: 0.5627, Val Acc: 0.1804
  ✅ New best model saved with val_acc: 0.1804
Blended Epoch 10/50: 100%|████████████████████| 391/391 [01:18<00:00,  4.96it/s]
Blended Epoch 10: Train Loss: 1.3924, Train Acc: 0.5749, Val Acc: 0.2092
  ✅ New best model saved with val_acc: 0.2092
Blended Epoch 11/50: 100%|████████████████████| 391/391 [01:20<00:00,  4.86it/s]
Blended Epoch 11: Train Loss: 1.3682, Train Acc: 0.5822, Val Acc: 0.1195
  No improvement for 1 epochs
Blended Epoch 12/50: 100%|████████████████████| 391/391 [01:18<00:00,  4.96it/s]
Blended Epoch 12: Train Loss: 1.3347, Train Acc: 0.5906, Val Acc: 0.1532
  No improvement for 2 epochs
Blended Epoch 13/50: 100%|████████████████████| 391/391 [01:21<00:00,  4.80it/s]
Blended Epoch 13: Train Loss: 1.3102, Train Acc: 0.5985, Val Acc: 0.1859
  No improvement for 3 epochs
Blended Epoch 14/50: 100%|████████████████████| 391/391 [01:21<00:00,  4.82it/s]
Blended Epoch 14: Train Loss: 1.2840, Train Acc: 0.6071, Val Acc: 0.1843
  No improvement for 4 epochs
Blended Epoch 15/50: 100%|████████████████████| 391/391 [01:23<00:00,  4.70it/s]
Blended Epoch 15: Train Loss: 1.2713, Train Acc: 0.6084, Val Acc: 0.2443
  ✅ New best model saved with val_acc: 0.2443
Blended Epoch 16/50: 100%|████████████████████| 391/391 [01:20<00:00,  4.84it/s]
Blended Epoch 16: Train Loss: 1.2443, Train Acc: 0.6196, Val Acc: 0.2225
  No improvement for 1 epochs
Blended Epoch 17/50: 100%|████████████████████| 391/391 [01:20<00:00,  4.84it/s]
Blended Epoch 17: Train Loss: 1.2339, Train Acc: 0.6231, Val Acc: 0.2082
  No improvement for 2 epochs
Blended Epoch 18/50: 100%|████████████████████| 391/391 [01:20<00:00,  4.83it/s]
Blended Epoch 18: Train Loss: 1.2151, Train Acc: 0.6294, Val Acc: 0.1628
  No improvement for 3 epochs
Blended Epoch 19/50: 100%|████████████████████| 391/391 [01:22<00:00,  4.77it/s]
Blended Epoch 19: Train Loss: 1.2114, Train Acc: 0.6294, Val Acc: 0.2054
  No improvement for 4 epochs
Blended Epoch 20/50: 100%|████████████████████| 391/391 [01:22<00:00,  4.75it/s]
Blended Epoch 20: Train Loss: 1.1868, Train Acc: 0.6369, Val Acc: 0.2170
  No improvement for 5 epochs
  🛑 Early stopping triggered after 20 epochs
  Best validation accuracy: 0.2443

🚀 Training BlendedTTT3fc model on CIFAR-10...
Blended3fc Epoch 1/50: 100%|██████████████████| 391/391 [01:20<00:00,  4.84it/s]
Blended3fc Epoch 1: Train Loss: 2.4446, Train Acc: 0.2476, Val Acc: 0.1017
  ✅ New best model saved with val_acc: 0.1017
Blended3fc Epoch 2/50: 100%|██████████████████| 391/391 [01:21<00:00,  4.81it/s]
Blended3fc Epoch 2: Train Loss: 2.1987, Train Acc: 0.3111, Val Acc: 0.1111
  ✅ New best model saved with val_acc: 0.1111
Blended3fc Epoch 3/50: 100%|██████████████████| 391/391 [01:24<00:00,  4.63it/s]
Blended3fc Epoch 3: Train Loss: 1.9524, Train Acc: 0.3638, Val Acc: 0.1130
  ✅ New best model saved with val_acc: 0.1130
Blended3fc Epoch 4/50: 100%|██████████████████| 391/391 [01:21<00:00,  4.82it/s]
Blended3fc Epoch 4: Train Loss: 1.8189, Train Acc: 0.4166, Val Acc: 0.1520
  ✅ New best model saved with val_acc: 0.1520
Blended3fc Epoch 5/50: 100%|██████████████████| 391/391 [01:20<00:00,  4.88it/s]
Blended3fc Epoch 5: Train Loss: 1.7358, Train Acc: 0.4464, Val Acc: 0.1193
  No improvement for 1 epochs
Blended3fc Epoch 6/50: 100%|██████████████████| 391/391 [01:23<00:00,  4.69it/s]
Blended3fc Epoch 6: Train Loss: 1.6682, Train Acc: 0.4725, Val Acc: 0.1273
  No improvement for 2 epochs
Blended3fc Epoch 7/50: 100%|██████████████████| 391/391 [01:26<00:00,  4.50it/s]
Blended3fc Epoch 7: Train Loss: 1.6014, Train Acc: 0.4928, Val Acc: 0.1991
  ✅ New best model saved with val_acc: 0.1991
Blended3fc Epoch 8/50: 100%|██████████████████| 391/391 [01:20<00:00,  4.84it/s]
Blended3fc Epoch 8: Train Loss: 1.5565, Train Acc: 0.5097, Val Acc: 0.2183
  ✅ New best model saved with val_acc: 0.2183
Blended3fc Epoch 9/50: 100%|██████████████████| 391/391 [01:22<00:00,  4.73it/s]
Blended3fc Epoch 9: Train Loss: 1.5285, Train Acc: 0.5193, Val Acc: 0.1745
  No improvement for 1 epochs
Blended3fc Epoch 10/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:20<00:00,  4.87it/s]
Blended3fc Epoch 10: Train Loss: 1.4981, Train Acc: 0.5283, Val Acc: 0.1409
  No improvement for 2 epochs
Blended3fc Epoch 11/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:22<00:00,  4.77it/s]
Blended3fc Epoch 11: Train Loss: 1.4673, Train Acc: 0.5420, Val Acc: 0.1967
  No improvement for 3 epochs
Blended3fc Epoch 12/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:24<00:00,  4.65it/s]
Blended3fc Epoch 12: Train Loss: 1.4441, Train Acc: 0.5491, Val Acc: 0.1960
  No improvement for 4 epochs
Blended3fc Epoch 13/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:23<00:00,  4.70it/s]
Blended3fc Epoch 13: Train Loss: 1.4126, Train Acc: 0.5570, Val Acc: 0.2064
  No improvement for 5 epochs
  🛑 Early stopping triggered after 13 epochs
  Best validation accuracy: 0.2183

=== TRAINING HEALER MODEL ===

🚀 Training Healer model on CIFAR-10...
Healer Epoch 1/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:09<00:00,  5.62it/s]
Healer Epoch 1: Train Loss: 2.8097, Train Type Acc: 0.6105, Val Loss: 1.7204, Val Type Acc: 0.8108
  ✅ New best model saved with val_loss: 1.7204
Healer Epoch 2/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.79it/s]
Healer Epoch 2: Train Loss: 2.3235, Train Type Acc: 0.7635, Val Loss: 1.6244, Val Type Acc: 0.8485
  ✅ New best model saved with val_loss: 1.6244
Healer Epoch 3/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:08<00:00,  5.75it/s]
Healer Epoch 3: Train Loss: 2.1519, Train Type Acc: 0.8202, Val Loss: 1.4685, Val Type Acc: 0.9023
  ✅ New best model saved with val_loss: 1.4685
Healer Epoch 4/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.80it/s]
Healer Epoch 4: Train Loss: 2.0328, Train Type Acc: 0.8504, Val Loss: 1.3192, Val Type Acc: 0.9233
  ✅ New best model saved with val_loss: 1.3192
Healer Epoch 5/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:08<00:00,  5.70it/s]
Healer Epoch 5: Train Loss: 1.9741, Train Type Acc: 0.8658, Val Loss: 1.3040, Val Type Acc: 0.9230
  ✅ New best model saved with val_loss: 1.3040
Healer Epoch 6/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:06<00:00,  5.84it/s]
Healer Epoch 6: Train Loss: 1.9430, Train Type Acc: 0.8715, Val Loss: 1.3029, Val Type Acc: 0.9323
  ✅ New best model saved with val_loss: 1.3029
Healer Epoch 7/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:09<00:00,  5.64it/s]
Healer Epoch 7: Train Loss: 1.9121, Train Type Acc: 0.8855, Val Loss: 1.2490, Val Type Acc: 0.9405
  ✅ New best model saved with val_loss: 1.2490
Healer Epoch 8/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.81it/s]
Healer Epoch 8: Train Loss: 1.9090, Train Type Acc: 0.8859, Val Loss: 1.2943, Val Type Acc: 0.9413
  No improvement for 1 epochs
Healer Epoch 9/50: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:09<00:00,  5.64it/s]
Healer Epoch 9: Train Loss: 1.9485, Train Type Acc: 0.8863, Val Loss: 1.2746, Val Type Acc: 0.9470
  No improvement for 2 epochs
Healer Epoch 10/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:05<00:00,  5.95it/s]
Healer Epoch 10: Train Loss: 1.9097, Train Type Acc: 0.8928, Val Loss: 1.2438, Val Type Acc: 0.9486
  ✅ New best model saved with val_loss: 1.2438
Healer Epoch 11/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.82it/s]
Healer Epoch 11: Train Loss: 1.9533, Train Type Acc: 0.8970, Val Loss: 1.2545, Val Type Acc: 0.9511
  No improvement for 1 epochs
Healer Epoch 12/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.82it/s]
Healer Epoch 12: Train Loss: 1.8956, Train Type Acc: 0.8946, Val Loss: 1.2380, Val Type Acc: 0.9456
  ✅ New best model saved with val_loss: 1.2380
Healer Epoch 13/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:06<00:00,  5.85it/s]
Healer Epoch 13: Train Loss: 1.8786, Train Type Acc: 0.8995, Val Loss: 1.2208, Val Type Acc: 0.9602
  ✅ New best model saved with val_loss: 1.2208
Healer Epoch 14/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.81it/s]
Healer Epoch 14: Train Loss: 1.8689, Train Type Acc: 0.9035, Val Loss: 1.2258, Val Type Acc: 0.9481
  No improvement for 1 epochs
Healer Epoch 15/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:05<00:00,  5.93it/s]
Healer Epoch 15: Train Loss: 1.9120, Train Type Acc: 0.9007, Val Loss: 1.1793, Val Type Acc: 0.9613
  ✅ New best model saved with val_loss: 1.1793
Healer Epoch 16/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.82it/s]
Healer Epoch 16: Train Loss: 1.9177, Train Type Acc: 0.9080, Val Loss: 1.2115, Val Type Acc: 0.9582
  No improvement for 1 epochs
Healer Epoch 17/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:08<00:00,  5.72it/s]
Healer Epoch 17: Train Loss: 1.8662, Train Type Acc: 0.9076, Val Loss: 1.1341, Val Type Acc: 0.9619
  ✅ New best model saved with val_loss: 1.1341
Healer Epoch 18/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.83it/s]
Healer Epoch 18: Train Loss: 1.8347, Train Type Acc: 0.9128, Val Loss: 1.2330, Val Type Acc: 0.9619
  No improvement for 1 epochs
Healer Epoch 19/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:07<00:00,  5.80it/s]
Healer Epoch 19: Train Loss: 1.8456, Train Type Acc: 0.9136, Val Loss: 1.1754, Val Type Acc: 0.9613
  No improvement for 2 epochs
Healer Epoch 20/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:08<00:00,  5.68it/s]
Healer Epoch 20: Train Loss: 1.8221, Train Type Acc: 0.9124, Val Loss: 1.2963, Val Type Acc: 0.9556
  No improvement for 3 epochs
Healer Epoch 21/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:08<00:00,  5.68it/s]
Healer Epoch 21: Train Loss: 1.8374, Train Type Acc: 0.9154, Val Loss: 1.1909, Val Type Acc: 0.9631
  No improvement for 4 epochs
Healer Epoch 22/50: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 391/391 [01:05<00:00,  5.93it/s]
Healer Epoch 22: Train Loss: 1.8187, Train Type Acc: 0.9234, Val Loss: 1.2244, Val Type Acc: 0.9696
  No improvement for 5 epochs
  🛑 Early stopping triggered after 22 epochs
  Best validation loss: 1.1341

=== EVALUATION PHASE ===

📋 Part 1: Clean Data Evaluation

================================================================================
📊 EVALUATING ALL MODELS ON CIFAR-10
================================================================================

🔍 Evaluating Main ViT...
Evaluating Main ViT: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:04<00:00, 17.76it/s]
✅ Main ViT Accuracy: 0.4691

🔍 Evaluating Robust ViT...
Evaluating Robust ViT: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:04<00:00, 17.81it/s]
✅ Robust ViT Accuracy: 0.2904

🔍 Evaluating ResNet18 Baseline...
/home/david-lacour/.pyenv/versions/myenv/lib/python3.12/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/home/david-lacour/.pyenv/versions/myenv/lib/python3.12/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=None`.
  warnings.warn(msg)
Evaluating ResNet18 Baseline: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:01<00:00, 48.70it/s]
✅ ResNet18 Baseline Accuracy: 0.9188

🔍 Evaluating ResNet18 Pretrained...
Evaluating ResNet18 Pretrained: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:01<00:00, 49.53it/s]
✅ ResNet18 Pretrained Accuracy: 0.9285

🔍 Evaluating TTT...
Evaluating TTT: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:05<00:00, 13.72it/s]
✅ TTT Accuracy: 0.4402

🔍 Evaluating BlendedTTT...
Traceback (most recent call last):
  File "/home/david-lacour/Documents/transformerVision/githubs/VizInt/autoflex/autotinymodels/main_cifar10_all.py", line 2039, in <module>
    main()
  File "/home/david-lacour/Documents/transformerVision/githubs/VizInt/autoflex/autotinymodels/main_cifar10_all.py", line 2016, in main
    results = evaluate_all_models(val_loader)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/david-lacour/Documents/transformerVision/githubs/VizInt/autoflex/autotinymodels/main_cifar10_all.py", line 1341, in evaluate_all_models
    model = BlendedTTT(img_size=IMG_SIZE, patch_size=4, embed_dim=384, depth=8, num_classes=NUM_CLASSES)
            ^^^^^^^^^^
NameError: name 'BlendedTTT' is not defined
